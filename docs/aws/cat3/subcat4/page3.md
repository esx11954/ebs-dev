# オブジェクトの識別方法

---

## キー

### キーとは

Amazon S3の「キー (Key)」とは、S3バケット内でオブジェクトを**一意に識別するための文字列**です。
S3がオブジェクトストレージであるため、従来のファイルシステムのようなディレクトリ構造は物理的には存在しません。
しかし、キーを利用することで、論理的な階層構造を表現し、オブジェクトを整理・管理することができます。
S3においては、キーとバケット名の組み合わせによって、オブジェクトにアクセスするための完全な識別子となります。

### キーの主要な特性

#### 1. バケット内での一意性

*   各オブジェクトは、そのバケット内で**一意のキー**を持つ必要があります。
*   同じバケット内で同じキーを持つオブジェクトをアップロードしようとすると、既存のオブジェクトが上書きされます（ただし、バージョニングが有効な場合は、古いオブジェクトが別バージョンとして保持されます）。

#### 2. 論理的な階層構造の表現

*   S3は内部的にフラットなオブジェクトストレージですが、キーにスラッシュ (`/`) を区切り文字として含めることで、S3コンソールや多くのS3クライアントツールで、あたかもフォルダのような階層構造を視覚的に表現できます。
*   例: `images/profiles/user1/photo.jpg` というキーは、ユーザーから見ると `images` フォルダの中の `profiles` フォルダの中の `user1` フォルダの中の `photo.jpg` のように見えます。
*   この階層はあくまで「プレフィックス (Prefix)」と呼ばれるキーの先頭部分の一致に基づいており、物理的なディレクトリ構造ではありません。
*   この論理的な階層は、オブジェクトの検索、フィルタリング、およびライフサイクルルールの適用に非常に役立ちます。

#### 3. 不変性 (Immutability)

*   一度S3にオブジェクトがアップロードされ、キーが決定されると、そのキーを変更することはできません。
*   キーを変更したい場合は、既存のオブジェクトを新しいキーでコピーし、元のオブジェクトを削除するという操作を行う必要があります。

#### 4. 最大長

*   キーの最大長は1024バイトです。
*   UTF-8エンコードされた文字を使用できます。

#### 5. 文字の制限と推奨事項

キーに使用できる文字にはほぼ制限がありませんが、特定の文字はURLエンコードが必要になったり、特別な意味を持ったりするため、使用を避けるのがベストプラクティスです。

| 良い例 (推奨)                                | 悪い例 (避けるべき、または注意が必要)                                                                                                   |
| :------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- |
| - 英数字 (`A-Z`, `a-z`, `0-9`)             | - 特殊文字: `&`, `$`, `@`, `=`, `;`, `+`, `,`, `?` などはURLエンコードが必要になる場合があります。                                |
| - スラッシュ (`/`)                           | - 空白文字: 処理が複雑になり、エラーの原因になることがあります。代わりにハイフン (`-`) やアンダースコア (`_`) を使用します。     |
| - ハイフン (`-`)                             | - バックスラッシュ (`\`)                                                                                                                |
| - アンダースコア (`_`)                       | - ドル記号 (`$`) : 特定の環境で変数と誤認される可能性があります。                                                                      |
| - ピリオド (`.`)                             | - `/` で始まるキー: URL解決に問題を起こすことがあります。                                                                                |
|                                              | - `.` や `-` で終わるキー: S3の内部動作や一部のツールで問題が発生する可能性があります。                                               |
| **推奨:**                                    | **非推奨:**                                                                                                                             |
| `folder/subfolder/file.txt`                  | ` folder\sub folder /file?.txt ` (空白、特殊文字、バックスラッシュを含む)                                                             |
| `my-document-2023-12.pdf`                    | `my document 2023.12.pdf` (空白、ピリオドの多用)                                                                                        |

### キー設計のベストプラクティス

効率的なS3利用のためには、キーの設計が非常に重要です。

*   **アクセスパターンを考慮する:**
    *   特定のプレフィックスで頻繁にデータを検索・取得する場合、そのプレフィックスがキーの先頭に来るように設計します (例: `logs/serviceA/2024/01/data.log`)。
*   **均一な分散:**
    *   S3はパフォーマンスを最適化するために、キーのプレフィックスに基づいてパーティションを分散します。
    *   特定のプレフィックスにアクセスが集中すると、パフォーマンスのボトルネックになる可能性があります。
    *   ランダムな文字列 (UUIDなど) をキーの先頭に含めることで、アクセスを均一に分散させ、大規模な並列処理でのパフォーマンスを向上させることができます (例: `uuid123-logs/serviceA/data.log` またはハッシュ値など)。
    *   ただし、S3は現在、プレフィックスのパフォーマンス制限を大幅に緩和しているため、この考慮事項の重要性は以前ほど高くはありませんが、大規模なワークロードでは依然として有効です。
*   **可読性:**
    *   人間が内容を理解しやすいキーにすることで、管理やデバッグが容易になります。
*   **ライフサイクル管理:**
    *   キープレフィックスを利用して、特定のグループのオブジェクトに対してライフサイクルルール（例: `logs/archive/` プレフィックスのオブジェクトは30日後にGlacierに移行）を適用できます。

キーはS3におけるオブジェクトの「名前」であると同時に、オブジェクトの整理、検索、管理、そしてパフォーマンスに深く関わる重要な要素です。
適切なキー設計を行うことで、S3の利用効率とコスト効率を最大化できます。

## S3 URI

### S3 URIとは

S3 URI (Uniform Resource Identifier) は、Amazon S3リソース、特にバケットやオブジェクトを識別するために使用される特定の形式のURIです。
これは、S3サービス内でリソースの場所を示す標準的な方法として機能します。
主にAWS CLI (Command Line Interface) やAWS SDK (Software Development Kit) を用いてプログラムからS3リソースを操作する際に利用されます。

### S3 URIの形式

S3 URIの基本的な形式は以下の通りです。

`s3://<バケット名>/<キー>`

*   **`s3://`**: これはURIスキームであり、対象のリソースがAmazon S3サービスに存在することを示します。
*   **`<バケット名>`**: 対象のオブジェクトが格納されているS3バケットのグローバルに一意な名前です。
*   **`<キー>`**: バケット内でオブジェクトを一意に識別する文字列です。キーは論理的なパスのように見えますが、単一の文字列として扱われます。オブジェクトを指定しない場合、キーは省略され、バケット全体を指します (`s3://<バケット名>/`)。

#### 具体的な例

*   **特定のオブジェクトを指す場合:**
    `s3://my-unique-bucket-2024/photos/profile.jpg`

*   **バケット全体を指す場合（キーを省略）:**
    `s3://my-unique-bucket-2024/` (末尾のスラッシュは通常省略可能ですが、含めることでバケット全体を指す意図を明確にできます)

*   **特定の「フォルダ」（プレフィックス）を指す場合:**
    `s3://my-unique-bucket-2024/documents/reports/` (このプレフィックスを持つ全てのオブジェクトが対象となります)

### S3 URIの主な用途と特徴

#### 1. AWS CLIでの利用

S3 URIは、AWS CLIでS3バケットやオブジェクトを操作する際に最も頻繁に使用されます。

*   **ファイルのコピー:**
    `aws s3 cp local_file.txt s3://my-unique-bucket-2024/remote_path/`

*   **ファイルの同期:**
    `aws s3 sync local_folder/ s3://my-unique-bucket-2024/remote_folder/`

*   **オブジェクトの削除:**
    `aws s3 rm s3://my-unique-bucket-2024/old_data.csv`

*   **オブジェクトの一覧表示:**
    `aws s3 ls s3://my-unique-bucket-2024/documents/`

#### 2. AWS SDKでの利用

プログラムからS3を操作する際に、SDKのAPIでS3リソースを指定する際にも同様の形式が使われることがあります。
SDKによっては、バケット名とキーを個別の引数として渡すことが多いですが、URI形式をサポートしている場合もあります。

#### 3. 内部的な表現

AWSの他のサービスやツールがS3リソースを参照する際にも、S3 URI形式が用いられることがあります。
例えば、AWS Lambda関数がS3バケット内の特定のファイルをトリガーとして実行される場合の設定などで見られます。

#### 4. リージョン情報を含まない

S3 URI自体には、リージョン情報が含まれていません。
S3リソースへのアクセス時には、AWS CLIやSDKが使用している認証情報や設定ファイル（例: `~/.aws/config`）に基づいて、デフォルトのリージョンが適用されるか、コマンドラインオプションで明示的にリージョンが指定されます。
これは、オブジェクトURLがリージョン情報を含む場合と対照的です。

#### 5. インターネット経由での直接アクセスには不向き

S3 URIは、ウェブブラウザから直接オブジェクトにアクセスするためのURLではありません。
ウェブブラウザからアクセスするには、後述の「オブジェクトURL」を使用する必要があります。
`s3://` スキームは、HTTP/HTTPSプロトコルとは異なるため、通常のウェブブラウザでは解釈できません。

### S3 URIと他のパス形式との比較

S3 URIは、プログラムによるS3リソースの操作に特化した、シンプルで直接的な識別子です。
他のパス形式との使い分けを理解することが重要です。

| パス形式                   | 目的                                                | 主な利用者                                            |
| :------------------------- | :-------------------------------------------------- | :---------------------------------------------------- |
| **キー**                   | バケット内でオブジェクトを一意に識別                | S3 API、内部的な参照                                 |
| **S3 URI**                 | AWS CLIやSDKでS3リソースをプログラム的に指定        | AWS CLI、AWS SDK、AWSサービス連携                     |
| **オブジェクトURL**        | ウェブブラウザなどからのHTTP/HTTPSアクセス          | エンドユーザー、Webアプリケーション、外部システム     |
| **Amazon リソースネーム (ARN)** | AWSサービス全体でリソースを一意に識別、ポリシー定義 | IAMポリシー、バケットポリシー、サービス間連携       |

S3 URIは、特にスクリプトや自動化されたプロセスでS3上のデータを扱う際に、そのシンプルさと明確さから重宝されます。

## オブジェクトURL

### オブジェクトURLとは

オブジェクトURL (Object URL) は、Amazon S3に保存されているオブジェクトに、HTTPまたはHTTPSプロトコルを使用してウェブブラウザや他のHTTPクライアントから直接アクセスするためのURLです。
S3に静的ウェブサイトをホスティングしたり、アプリケーションから画像や動画などのコンテンツを配信したりする場合に不可欠なパス形式です。

### オブジェクトURLの形式

S3のオブジェクトURLには、主に2つの形式があります。
現在では**仮想ホスト形式**が推奨されており、パス形式は一部のリージョンでレガシーな形式として残っているか、新規バケットでは使用できない場合があります。

#### 1. 仮想ホスト形式 (Virtual Hosted Style URL) - 推奨

この形式では、バケット名がホスト名のサブドメインとして使用されます。

`https://<バケット名>.s3.<リージョン名>.amazonaws.com/<キー>`

*   **`<バケット名>`**: 対象のオブジェクトが格納されているS3バケットのグローバルに一意な名前です。
*   **`s3.<リージョン名>.amazonaws.com`**: S3サービスのエンドポイントを表し、オブジェクトが格納されているAWSリージョンを示します。
*   **`<キー>`**: バケット内でオブジェクトを一意に識別するキーです。

**具体例:**

*   バケット名: `my-website-content`
*   リージョン: `ap-northeast-1` (東京リージョン)
*   キー: `images/logo.png`

オブジェクトURL: `https://my-website-content.s3.ap-northeast-1.amazonaws.com/images/logo.png`

#### 2. パス形式 (Path Style URL) - 非推奨

この形式では、バケット名がURLパスの一部として使用されます。

`https://s3.<リージョン名>.amazonaws.com/<バケット名>/<キー>`

または、米国東部 (バージニア北部) リージョン (us-east-1) のみ、リージョン名を省略した形式も存在します。

`https://s3.amazonaws.com/<バケット名>/<キー>`

**具体例:**

*   バケット名: `my-website-content`
*   リージョン: `ap-northeast-1`
*   キー: `images/logo.png`

オブジェクトURL: `https://s3.ap-northeast-1.amazonaws.com/my-website-content/images/logo.png`

:::caution
**注意点:**

*   2020年以降に作成された新しいバケットでは、パス形式のURLが使用できなくなっているリージョンがあります。
*   仮想ホスト形式がAWSのベストプラクティスとして推奨されており、一貫性、将来性、そしてカスタムドメインとの連携のしやすさの点で優れています。
:::

### オブジェクトURLの主な用途と特徴

#### 1. ウェブブラウザからの直接アクセス

*   オブジェクトがパブリックアクセス可能に設定されている場合、このURLをブラウザに入力するだけでコンテンツ（画像、動画、HTMLなど）を直接表示・ダウンロードできます。
*   これにより、静的コンテンツの配信が非常に容易になります。

#### 2. 静的ウェブサイトホスティング

*   S3バケットを静的ウェブサイトホスティングとして設定すると、そのバケット内のオブジェクトURLがウェブサイトのURLとして機能します。
*   例えば、`index.html` というキーのオブジェクトは、バケットのウェブサイトエンドポイントのルートURLからアクセスできるようになります。

#### 3. アプリケーションからの利用

*   ウェブアプリケーションやモバイルアプリケーションで、画像、動画、CSS、JavaScriptファイルなどをS3から配信する際に、オブジェクトURLが利用されます。
*   例えば、HTMLの `<img>` タグの `src` 属性にS3のオブジェクトURLを指定することで、S3に保存された画像をウェブページに表示できます。

#### 4. 署名付きURL (Presigned URL)

*   S3オブジェクトはデフォルトでプライベートであり、アクセスには認証が必要です。
*   しかし、一時的に特定のユーザーにオブジェクトへのアクセスを許可したい場合、有効期限付きの「署名付きURL」を生成できます。
*   この署名付きURLは、通常のオブジェクトURLに認証情報と有効期限がクエリパラメータとして付加されたもので、誰でもそのURLを知っていれば、有効期限内はオブジェクトにアクセスできます。

#### 5. リージョン情報を含む

*   オブジェクトURL（特に仮想ホスト形式）には、S3バケットが作成されたリージョン名が含まれます。
*   これにより、オブジェクトが世界中のどこに保存されているかがURLから明確に分かります。

#### 6. CDN (CloudFront) との連携

*   S3のオブジェクトURLをAmazon CloudFrontなどのCDN (Content Delivery Network) のオリジンとして設定することで、コンテンツの高速配信、SSL/TLS終端、キャッシュなどの機能を利用できます。
*   この場合、ユーザーはCloudFrontのURL経由でコンテンツにアクセスし、CloudFrontがS3からコンテンツを取得して配信します。

オブジェクトURLは、S3に保存されたデータを外部に公開・配信するための最も一般的な手段です。
その形式と利用シーンを理解することは、S3を活用したウェブサービスやアプリケーションの構築において非常に重要です。

## Amazon リソースネーム (ARN)

### Amazon リソースネーム (ARN) とは

Amazon リソースネーム (ARN) は、AWSのサービス全体で**特定のリソースを一意に識別するための標準的な命名規則**です。
S3においても、バケット、オブジェクト、アクセスポイントなどのリソースはARN形式で識別されます。
ARNは主にIAM (Identity and Access Management) ポリシーやリソースベースのポリシー（バケットポリシーなど）で、アクセスを許可または拒否する対象リソースを指定する際に使用されます。

### ARNの基本的な形式

ARNは、以下のコンポーネントで構成される標準化された形式を持っています。

`arn:aws:<サービス>:<リージョン>:<アカウントID>:<リソースタイプ>/<リソースパス>`

S3リソースのARNは、以下のように表現されます。

*   **バケットのARN:** `arn:aws:s3:::<バケット名>`
*   **オブジェクトのARN:** `arn:aws:s3:::<バケット名>/<キー>`
*   **特定のオブジェクトバージョンのARN:** `arn:aws:s3:::<バケット名>/<キー>?versionId=<バージョンID>`

#### 各コンポーネントの説明

*   **`arn`**: Amazon リソースネームであることを示すプレフィックス。
*   **`aws`**: パーティション。通常は `aws` ですが、AWS GovCloudや中国リージョンでは異なる場合があります。
*   **`s3`**: サービス。S3サービスのリソースであることを示します。
*   **`<リージョン>`**: S3のARNでは、**バケットのARNとオブジェクトのARNにはリージョンが含まれません** (空文字列として扱われる)。これはS3バケット名がグローバルに一意であるためです。ただし、S3アクセスポイントのARNなど、一部のS3関連リソースのARNにはリージョンが含まれる場合があります。
*   **`<アカウントID>`**: AWSアカウントの一意な12桁の識別子です。S3のARNでは、これも空文字列として扱われます。S3リソースへのアクセス制御は、主にバケット名とキー、そしてリクエスト元のIAMエンティティのコンテキストで評価されます。
*   **`<リソースタイプ>`**: S3では明示的なリソースタイプは省略され、直接リソースパスが続きます。
*   **`<リソースパス>`**:
    *   バケットの場合: バケット名 (`<バケット名>`)
    *   オブジェクトの場合: バケット名とキー (`<バケット名>/<キー>`)

#### 具体的な例

*   **バケット `my-example-bucket` のARN:**
    `arn:aws:s3:::my-example-bucket`

*   **バケット `my-example-bucket` 内のオブジェクト `documents/report.pdf` のARN:**
    `arn:aws:s3:::my-example-bucket/documents/report.pdf`

*   **バケット `my-example-bucket` 内のオブジェクト `data.csv` の特定のバージョン (`xxxxxxxx`) のARN:**
    `arn:aws:s3:::my-example-bucket/data.csv?versionId=xxxxxxxx`

### ARNの主な用途と重要性

#### 1. IAMポリシーとバケットポリシー

*   ARNの最も重要な用途は、AWSのアクセス制御ポリシー（IAMポリシー、バケットポリシー）において、アクセスを許可または拒否するリソースを正確に指定することです。
*   例えば、特定のIAMユーザーに特定のS3バケットへの読み取りアクセスのみを許可するポリシーを記述する際に、そのバケットのARNを使用します。

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": { "AWS": "arn:aws:iam::<アカウントID>:user/my-s3-user" },
          "Action": ["s3:GetObject", "s3:ListBucket"],
          "Resource": [
            "arn:aws:s3:::my-example-bucket",
            "arn:aws:s3:::my-example-bucket/*"
          ]
        }
      ]
    }
    ```
    上記ポリシーでは、`Resource`要素でARNを用いて、`my-example-bucket`バケット自体とその中の全てのオブジェクト(`my-example-bucket/*`)へのアクセス権限を定義しています。

#### 2. AWSサービス間連携

*   AWS Lambda、AWS Glue、Amazon Kinesisなど、他のAWSサービスがS3リソースと連携する際の設定において、対象のS3リソースをARNで指定することがよくあります。
*   例えば、Lambda関数のトリガーとしてS3バケットを指定する場合、そのバケットのARNが必要です。

#### 3. クラウド監査とロギング

*   AWS CloudTrailなどの監査ログでは、API呼び出しによってアクセスされたリソースがARN形式で記録されるため、特定のリソースに対する操作履歴を追跡する際に役立ちます。

#### 4. リソースの一意な識別

*   AWS環境内で多数のリソースが存在する場合でも、ARNを使用することで目的のリソースを曖昧さなく一意に識別できます。

### ARNと他のパス形式との違い

ARNは、S3 URIやオブジェクトURLとは異なる目的で利用されます。

| パス形式                   | 目的                                                                       | 主な利用場所                                       | リージョン/アカウントID情報 |
| :------------------------- | :------------------------------------------------------------------------- | :------------------------------------------------- | :-------------------------- |
| **キー**                   | バケット内でオブジェクトを一意に識別                                       | S3 API呼び出しの引数、S3コンソールでの表示         | なし                        |
| **S3 URI**                 | AWS CLIやSDKでS3リソースをプログラム的に指定                               | AWS CLI、AWS SDK                                   | なし (設定から推測)         |
| **オブジェクトURL**        | ウェブブラウザなどからのHTTP/HTTPSアクセス                                 | ウェブアプリケーション、外部サービス、直接ブラウザ | 含む (ホスト名の一部)       |
| **Amazon リソースネーム (ARN)** | AWSサービス全体でリソースを一意に識別し、**アクセス制御ポリシーで指定**する | IAMポリシー、バケットポリシー、サービス連携        | S3リソースでは含まれない    |

ARNは、AWSリソースのセキュリティとガバナンスを管理するための基盤となる重要な概念です。
特に、最小権限の原則に基づいたアクセス制御を実装する上で不可欠な要素となります。

## S3の種類 (ストレージクラス)

### ストレージクラスとは

Amazon S3は、顧客の多様なニーズ（アクセス頻度、復元要件、耐久性、コスト）に対応するため、複数の「ストレージクラス」を提供しています。
ストレージクラスは、オブジェクトをどのように保存し、どの程度のコストで提供するかを定義する属性です。
適切なストレージクラスを選択することで、ストレージコストを大幅に最適化し、同時にビジネス要件を満たすことができます。

### S3のストレージクラスの概要

S3のストレージクラスは、主に以下の要素に基づいて選択されます。

*   **アクセス頻度:** オブジェクトにどれくらいの頻度でアクセスするか（高頻度、低頻度、ほとんどアクセスしない）。
*   **復元時間:** データが必要になった場合に、どれくらいの速さで復元できる必要があるか（ミリ秒単位、数分、数時間）。
*   **耐久性:** データの喪失に対する保護レベル（全てのクラスで非常に高い耐久性を提供しますが、内部的な実装が異なります）。
*   **可用性:** データにアクセスできる信頼性（稼働時間）。
*   **コスト:** ストレージ容量、データ取得、データ転送にかかる費用。

これらの要素のトレードオフを理解し、最適なストレージクラスを選択することが、クラウド利用におけるコスト最適化の鍵となります。

### 主要なS3ストレージクラス

S3が提供する主要なストレージクラスを以下の表にまとめました。

| ストレージクラス                   | 説明                                                                                                     | アクセス頻度     | 最低保管期間 | 復元時間           | コスト                               | ユースケース                                                                                                |
| :------------------------------- | :------------------------------------------------------------------------------------------------------- | :--------------- | :----------- | :----------------- | :----------------------------------- | :---------------------------------------------------------------------------------------------------------- |
| **S3 標準 (Standard)**           | 高頻度アクセス、ミリ秒単位のデータアクセスを必要とする汎用的なデータストレージ。                         | 高               | なし         | ミリ秒             | 標準 (高)                            | クラウドアプリケーション、動的ウェブサイト、ビッグデータ分析、コンテンツ配信、モバイルアプリのデータ |
| **S3 Intelligent-Tiering**      | アクセスパターンが不明なデータや変化するデータ向け。アクセスパターンを監視し、自動的に最適なストレージ層に移動。 | 可変 (自動調整)  | なし         | ミリ秒             | 最適化 (監視費用あり)                | アクセス頻度が予測不能なデータ、データレイク、長期にわたる分析ログ                                          |
| **S3 標準-IA (Infrequent Access)** | アクセス頻度が低いが、必要に応じてミリ秒単位でデータを取り出せる必要があるデータ向け。                   | 低               | 30日         | ミリ秒             | 容量安、取得料高                     | バックアップ、災害復旧ファイル、長期保存されるログファイル                                                  |
| **S3 1ゾーン-IA (One Zone-Infrequent Access)** | 標準-IAと同様に低頻度アクセス向けだが、単一のAZにデータを保存することでコストを削減。AZ障害時にはデータ損失の可能性あり。 | 低               | 30日         | ミリ秒             | 標準-IAよりさらに安い (容量)         | 簡単に再作成できるセカンダリバックアップ、ログのアーカイブ、開発/テストデータ                               |
| **S3 Glacier Instant Retrieval** | 数年に一度程度しかアクセスしないが、必要に応じてミリ秒単位で取り出せるアーカイブデータ向け。           | 非常に低い       | 90日         | ミリ秒             | Glacier IAより容量安、取得料高         | 医用画像、財務記録、メディア資産などのアーカイブ                                                            |
| **S3 Glacier Flexible Retrieval** | 数分から数時間で復元できる柔軟なアーカイブデータ向け。数時間かかっても良いデータに適している。         | 非常に低い (バッチ処理) | 90日         | 数分～数時間       | Glacier Instantより容量安、取得料安    | 長期バックアップ、アーカイブ、メディアコンテンツのオフロード                                                |
| **S3 Glacier Deep Archive**      | ほとんどアクセスしない、最もコスト効率の高いアーカイブストレージ。復元に数時間かかる。                   | 極めて低い       | 180日        | 数時間 (最大12時間) | 最安値 (容量)                        | 規制要件に基づく長期コンプライアンスアーカイブ、データのオフサイトバックアップ                              |

### 各ストレージクラスの詳細 (概要)

#### S3 標準 (Standard)

*   **特徴:** 高い耐久性 (11ナイン)、高い可用性 (99.99%)、低レイテンシ、高スループット。
*   **料金:** ストレージ容量、リクエスト数、データ転送量に対して課金。
*   **最適ユースケース:** アクセス頻度が高いデータ、動的ウェブサイトのコンテンツ、クラウドアプリケーションのデータ、ビッグデータ分析用データレイクなど。

#### S3 Intelligent-Tiering

*   **特徴:** オブジェクトのアクセスパターンを継続的に監視し、最適なアクセス層に自動的に移動させます。頻繁にアクセスされるオブジェクトは高頻度アクセス層 (S3標準) に、30日間アクセスがないオブジェクトは低頻度アクセス層 (S3 標準-IA) に、90日間アクセスがないオブジェクトはアーカイブインスタントアクセス層 (Glacier Instant Retrieval) に自動的に移動します。さらに長い期間アクセスがない場合は、Glacier Flexible Retrieval層に移動することも可能です。
*   **料金:** 各層のストレージ料金に加え、監視・自動階層化のための少額の月額料金がかかります。データ取得料金は各層に準じます。
*   **最適ユースケース:** アクセスパターンが不規則または変化するデータ、新しいデータレイク、アクセス頻度が不明なアプリケーションデータ。

#### S3 標準-IA (Infrequent Access)

*   **特徴:** S3標準と同じ耐久性と可用性、ミリ秒単位のアクセス速度を提供しますが、ストレージ容量あたりの料金が安く、データ取得には別途料金がかかります。
*   **料金:** ストレージ容量は安いが、データ取得量に応じて課金が発生。最低30日間の保管料金が適用されます。
*   **最適ユースケース:** アクセス頻度が低いが、急なアクセス要請があるバックアップデータ、災害復旧ファイル、長期保存されるログ。

#### S3 1ゾーン-IA (One Zone-Infrequent Access)

*   **特徴:** 標準-IAに似ていますが、データを**単一のAZ**にのみ保存します。これによりコストをさらに削減できますが、AZ障害が発生した場合にはデータが失われる可能性があります。
*   **料金:** 標準-IAよりも容量料金が安いです。最低30日間の保管料金が適用されます。
*   **最適ユースケース:** 簡単に再生成できるセカンダリバックアップ、分析用のデータレイク、開発・テスト環境のデータなど、データ損失のリスクを許容できる場合。

#### S3 Glacier Instant Retrieval

*   **特徴:** 年に数回程度のアクセス頻度を持つアーカイブデータ向け。データ復元はミリ秒単位で可能です。
*   **料金:** S3標準-IAよりも容量料金が安く、データ取得料金がかかります。最低90日間の保管料金が適用されます。
*   **最適ユースケース:** 医用画像、財務記録、研究データなど、めったにアクセスしないが、必要なときにすぐに復元する必要があるアーカイブ。

#### S3 Glacier Flexible Retrieval

*   **特徴:** 数分から数時間かかる復元オプションを持つアーカイブデータ。数分 (迅速) から数時間 (標準、大容量) で復元できる柔軟なオプションを提供します。
*   **料金:** S3 Glacier Instant Retrievalよりも容量料金が安く、データ取得料金がかかります。最低90日間の保管料金が適用されます。
*   **最適ユースケース:** 長期的なデータアーカイブ、オフサイトデータバックアップ、メディアコンテンツのオフロードなど、復元に数時間かかっても問題ないデータ。

#### S3 Glacier Deep Archive

*   **特徴:** 最もコスト効率の高いストレージクラス。アクセス頻度が極めて低く、復元に数時間（標準復元で約12時間以内）かかるアーカイブデータ向けです。
*   **料金:** S3ストレージクラスの中で最も容量料金が安いです。最低180日間の保管料金が適用されます。
*   **最適ユースケース:** 規制要件に基づく長期コンプライアンスアーカイブ、磁気テープライブラリの置き換え、数十年にわたるデータ保存。

### まとめ

S3のストレージクラスを適切に選択することは、クラウド環境におけるストレージコストを最適化し、同時にデータのアクセス要件と耐久性要件を満たすために不可欠です。
ライフサイクル管理ルールと組み合わせることで、データの時間経過とともに自動的にストレージクラスを移行させ、コスト効率の良い運用を実現できます。

## S3 標準

### S3 標準ストレージクラスの概要

Amazon S3 標準 (Standard) は、S3が提供するストレージクラスの中で最も汎用性が高く、デフォルトで利用されるクラスです。
頻繁にアクセスされるデータ向けに設計されており、高い耐久性、高い可用性、そして低レイテンシで高スループットなパフォーマンスを提供します。
多岐にわたるユースケースに対応できるバランスの取れたストレージソリューションです。

### 主要な特徴

S3 標準は、ビジネスアプリケーションの要件を満たすために必要な堅牢性とパフォーマンスを備えています。

#### 1. 高い耐久性

*   **99.999999999% (イレブンナイン) の耐久性**を誇ります。
*   これは、オブジェクトが物理的なドライブ障害やデータセンター障害によって失われる可能性が極めて低いことを意味します。
*   S3は、オブジェクトを**選択したリージョン内の複数のアベイラビリティゾーン (AZ)** に自動的に複製・分散することで、この高い耐久性を実現しています。
*   ユーザーは内部的なレプリケーションや冗長性を意識する必要がありません。

#### 2. 高い可用性

*   **99.99% の可用性**をSLA (Service Level Agreement) で保証しています。
*   これは、S3標準に保存されたデータに、年間でほとんどの時間アクセス可能であることを意味します。
*   複数のAZにデータを分散することで、単一のAZ障害が発生してもサービスが中断することなく、データにアクセスできます。

#### 3. 高パフォーマンス

*   **低レイテンシ** (通常、ミリ秒単位でのデータアクセス) と**高スループット**を提供します。
*   これにより、ウェブアプリケーションやモバイルアプリケーションなど、リアルタイムに近いアクセスを要求するワークロードに適しています。

#### 4. 最低保管期間の制限なし

*   S3標準には、オブジェクトの最低保管期間という概念がありません。
*   オブジェクトをアップロード後すぐに削除しても、追加料金が発生することはありません。
*   これは、他の低頻度アクセスやアーカイブ用のストレージクラスとの大きな違いです。

#### 5. 料金体系

*   S3標準の料金は、主に以下の要素に基づいて計算されます。

    *   **ストレージ容量:** 保存しているデータの量 (GBあたり月額)。
    *   **リクエスト数:** データ取得 (GET)、データ書き込み (PUT) などのAPIリクエスト数。
    *   **データ転送量:** S3からインターネットへのデータ転送量 (アウトバウンド)。同じリージョン内のAWSサービスへのデータ転送は通常無料です。

### 最適なユースケース

S3 標準は、以下の様な幅広いデータやアプリケーションに最適です。

*   **クラウドネイティブアプリケーションのデータストア:** モバイルアプリやウェブアプリのユーザーコンテンツ、メディアファイル。
*   **動的ウェブサイトのコンテンツ:** 画像、動画、CSS、JavaScriptなどの頻繁にアクセスされるコンテンツ。
*   **ビッグデータ分析:** Apache SparkやAWS Athenaなどの分析サービスが頻繁にアクセスするデータレイクの基盤。
*   **コンテンツ配信:** Amazon CloudFrontなどのCDN (Content Delivery Network) のオリジンとして利用されるデータ。
*   **同期および共有のためのデータ:** 複数のユーザーやアプリケーションが共有するファイル。
*   **一般的なファイルストレージ:** 高い頻度で読み書きされるドキュメント、プレゼンテーション、スプレッドシートなど。
*   **高頻度でアクセスされるバックアップ:** 頻繁なリストアが想定されるデータバックアップ。

### 他のストレージクラスとの比較

S3標準は、他のストレージクラスと比較して、最高のアクセス頻度とパフォーマンスを提供しますが、その分、容量あたりの料金は高めです。
アクセス頻度が低下するデータや、長期保存のみが目的のデータには、S3標準-IA、S3 Glacier Instant Retrieval、S3 Glacier Flexible Retrieval、S3 Glacier Deep Archiveといった、よりコスト効率の良いストレージクラスへの移行を検討することが重要です。
S3 Intelligent-Tieringは、アクセスのパターンが不明または変化するデータに対して、S3標準を含む複数の層間で自動的にデータを移動させることでコストを最適化できるオプションです。

S3 標準は、その卓越した耐久性、可用性、パフォーマンスにより、AWSクラウドにおける多くの主要なワークロードの基盤となっています。
データのアクセス頻度や重要度に応じて、最適なストレージクラスを選択することがコストとパフォーマンスのバランスを取る上で非常に重要です。