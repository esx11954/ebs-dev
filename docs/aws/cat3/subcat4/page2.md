# S3の基本構造

---

## S3の構造

Amazon S3は、非常にシンプルでありながら、グローバルに分散された堅牢なインフラストラクチャの上に構築されています。
その構造を理解することは、S3を効果的に利用し、データ管理戦略を最適化する上で不可欠です。

### 階層構造の概要

S3は、大きく分けて以下の要素から構成されます。

*   **グローバルインフラストラクチャ:** リージョンとアベイラビリティゾーン (AZ)
*   **ストレージコンテナ:** バケット
*   **実際のデータ:** オブジェクト
*   **オブジェクトの識別子:** キー

これらの要素が組み合わさることで、データはS3に保存され、アクセス可能になります。

### S3の物理的・論理的構造

S3は、物理的なインフラストラクチャの上に、論理的なデータ構造が構築されています。

#### 物理インフラストラクチャ

S3の基盤となるのは、AWSのグローバルインフラストラクチャです。

*   **リージョン (Region):**
    *   世界中に分散された地理的なエリアです。
    *   各リージョンは完全に独立しており、データは作成されたリージョン内に保存されます（明示的なレプリケーション設定がない限り）。
    *   データローカリティ、レイテンシ、規制遵守の観点からリージョンを選択します。

*   **アベイラビリティゾーン (Availability Zone - AZ):**
    *   各リージョン内に複数存在する、互いに物理的に隔離されたデータセンターの集合体です。
    *   独立した電源、冷却、ネットワークを備えており、単一のAZ障害が他のAZに影響を及ぼさないように設計されています。
    *   S3は、ユーザーが意識することなく、複数のAZにわたってデータを自動的に複製・分散することで、高い耐久性と可用性を実現しています。

#### 論理データ構造

ユーザーがS3と直接やり取りする際の論理的な構造は、主にバケットとオブジェクトです。

*   **バケット (Bucket):**
    *   S3にデータを保存するための最上位のコンテナです。
    *   全てのオブジェクトは、必ずいずれかのバケット内に保存されます。
    *   バケット名はグローバルに一意である必要があります (例: `my-unique-company-data-bucket-123`)。
    *   バケットは特定のAWSリージョンに関連付けられますが、その名前はAWS全体で一意である必要があります。

*   **オブジェクト (Object):**
    *   バケット内に保存される実際のデータ（ファイル）と、そのデータに関連付けられたメタデータ（オブジェクトサイズ、最終更新日など）の集合体です。
    *   データ自体はバイナリの塊として保存され、S3が内部的にどのようにデータを配置するかを意識する必要はありません。

*   **キー (Key):**
    *   バケット内でオブジェクトを一意に識別する文字列です。
    *   オブジェクトの「名前」や「パス」に相当します。
    *   S3はフラットなオブジェクトストレージですが、キーにスラッシュ (`/`) を含めることで、フォルダのような階層構造を論理的に表現できます (例: `documents/reports/2023/q4_report.pdf`)。

### S3の構造の図解

S3の構造を視覚的に表現すると、以下のようになります。

```
AWS Global Infrastructure
  └─ Region (例: ap-northeast-1 / 東京リージョン)
       ├─ Availability Zone 1 (例: ap-northeast-1a)
       ├─ Availability Zone 2 (例: ap-northeast-1c)
       └─ Availability Zone 3 (例: ap-northeast-1d)
            └─ S3 Service (複数のAZにわたってデータを分散・管理)
                 └─ Bucket (グローバルに一意な名前、特定のリージョンに関連付け)
                      ├─ Object (データ + メタデータ + キー)
                      │    └─ Key: "images/logo.png"
                      ├─ Object (データ + メタデータ + キー)
                      │    └─ Key: "documents/report.pdf"
                      └─ Object (データ + メタデータ + キー)
                           └─ Key: "data/raw_data_20240101.csv"
```

この構造により、S3はユーザーに対してシンプルなインターフェースを提供しつつも、バックエンドでデータの耐久性、可用性、スケーラビリティを確保しています。
ユーザーはオブジェクトをバケットにアップロードするだけで、AWSがそのデータを複数のAZに分散・複製し、堅牢に管理してくれます。

## リージョン

### リージョンとは

AWSにおけるリージョン (Region) とは、世界中に地理的に分散された、独立したインフラストラクチャの集合体です。
各リージョンは、AWSのサービスとリソースをホストするための、完全に隔離された物理的な場所です。
S3もこのリージョンを基盤として動作し、データは指定されたリージョン内に保存されます。

### リージョンの特徴

#### 1. 地理的な分離と独立性

*   各リージョンは、他のリージョンから物理的にも論理的にも完全に分離されています。
*   これにより、あるリージョンで障害が発生しても、他のリージョンには影響が及ばないよう設計されています。
*   災害対策 (Disaster Recovery) の戦略において、異なるリージョンにデータを複製することは非常に重要です。

#### 2. データローカリティ (Data Locality)

*   S3に保存されたオブジェクトは、指定されたリージョン内に物理的に存在します。
*   これは、データへのアクセスレイテンシ (遅延) に影響を与えます。
*   ユーザーやアプリケーションの地理的な近さに基づいてリージョンを選択することで、データへのアクセス速度を最適化できます。

#### 3. 法的・規制要件への準拠

*   国や地域によっては、データの保存場所（データレジデンシー）に関する法的要件や規制があります。
*   例えば、EUのGDPR (一般データ保護規則) や日本の個人情報保護法などです。
*   これらの要件を満たすために、適切なリージョンを選択することが不可欠です。

#### 4. コストの違い

*   AWSサービスの料金は、リージョンによって異なる場合があります。
*   S3のストレージ料金やデータ転送料金も、リージョンごとに設定されています。
*   コスト最適化の観点から、料金比較もリージョン選択の一要因となります。

#### 5. サービスの利用可能性

*   AWSの新しいサービスや特定の機能は、すべてのリージョンで同時に利用可能になるとは限りません。
*   必要なサービスが利用可能なリージョンを選択する必要があります。

### S3におけるリージョンの重要性

S3を利用する上で、リージョン選択は以下の点で非常に重要です。

*   **バケットの作成:**
    *   S3バケットを作成する際には、必ずどのリージョンに作成するかを指定します。
    *   バケット名自体はグローバルに一意である必要がありますが、バケットそのものは特定のリージョンに属します。

*   **データの所在地:**
    *   S3にアップロードされたデータは、そのバケットが作成されたリージョンに保存されます。
    *   デフォルトでは、データがリージョン外に出ることはありません。

*   **高い耐久性と可用性:**
    *   S3は、選択されたリージョン内の複数のアベイラビリティゾーン (AZ) にわたってデータを自動的に複製・分散することで、リージョン内での高い耐久性と可用性を実現しています。
    *   ユーザーは、AZを意識することなく、リージョンを選択するだけでこの恩恵を受けられます。

*   **データ転送:**
    *   同じリージョン内のAWSサービス間でのデータ転送は、通常、無料または低コストです。
    *   異なるリージョン間のデータ転送 (アウトバウンド) には、追加の料金が発生します。
    *   クロスリージョンレプリケーションを設定しない限り、データはリージョンをまたいで自動的に移動することはありません。

### リージョン選択の考慮事項

アプリケーションを設計する際には、以下の点を考慮してS3バケットを作成するリージョンを選択します。

*   **ユーザーの物理的な場所:** レイテンシを最小限に抑えるため、主要なユーザーベースに最も近いリージョン。
*   **規制・コンプライアンス要件:** データレジデンシーに関する法的義務を満たすリージョン。
*   **コスト:** 最もコスト効率の良いリージョン。
*   **既存のAWSリソース:** 他のAWSサービスが既にデプロイされているリージョン。
*   **災害対策:** メインのリージョンから離れたバックアップリージョン。

リージョンは、AWSインフラストラクチャの論理的な境界線であり、データの管理、セキュリティ、パフォーマンス、コストに大きな影響を与えるため、慎重な選択が求められます。

## アベイラビリティゾーン (AZ)

### アベイラビリティゾーン (AZ) とは

アベイラビリティゾーン (AZ: Availability Zone) とは、AWSリージョン内にある、互いに物理的に隔離された独立したデータセンターの集合体です。
各リージョンには、通常2つ以上のAZが存在します。
AZは、単一のリージョン内での高可用性と耐障害性を実現するために設計されています。

### AZの主要な特徴

#### 1. 物理的および論理的隔離

*   各AZは、独立した電力、冷却システム、物理的セキュリティ、ネットワーク接続を備えています。
*   これにより、あるAZで発生した障害（例: 停電、火災、ネットワーク障害など）が、同じリージョン内の他のAZに影響を及ぼさないように設計されています。

#### 2. 低レイテンシのネットワーク接続

*   同じリージョン内のAZ間は、低レイテンシで高帯域幅のネットワークで接続されています。
*   これにより、アプリケーションが複数のAZにまたがってデプロイされていても、データの同期や通信が効率的に行えます。

#### 3. 耐障害性の向上

*   アプリケーションやデータを複数のAZに分散して配置することで、単一のデータセンター障害に耐えられるシステムを構築できます。
*   例えば、データベースを複数のAZに冗長構成でデプロイすることで、一方のAZで障害が発生しても、もう一方のAZでサービスを継続できます。

### S3におけるAZの役割

S3は、ユーザーが直接AZを指定することなく、その内部でAZの概念を最大限に活用してデータの耐久性と可用性を確保しています。

#### 1. データの自動複製と分散

*   S3にアップロードされたオブジェクトは、自動的に選択されたリージョン内の**少なくとも3つのアベイラビリティゾーン**にわたって複製・分散されます。
*   この自動的なデータ分散により、単一のAZで障害が発生しても、データが失われることなく、常にアクセス可能な状態を維持します。
*   この仕組みが、S3の「99.999999999% (イレブンナイン) の耐久性」と「99.99% の可用性」という非常に高いSLA (Service Level Agreement) の基盤となっています。

#### 2. ユーザーからの抽象化

*   S3の利用者（開発者や管理者）は、どのAZにデータが保存されているかを意識したり、手動でAZを指定したりする必要がありません。
*   S3サービス自体が、バックエンドでデータの複製、分散、整合性管理を自動的に行います。
*   これにより、ユーザーはシンプルなオブジェクトストレージとしてS3を利用できる一方で、AWSの堅牢なインフラストラクチャの恩恵を受けることができます。

#### 3. リージョン全体での高可用性

*   S3バケットは特定のリージョンに属し、そのリージョン内の複数のAZを利用して冗長性が確保されます。
*   したがって、S3はリージョンレベルで高可用性を提供するサービスと見なされます。

### AZとリージョンの関係

| 特徴                 | リージョン (Region)                                          | アベイラビリティゾーン (AZ)                                          |
| :------------------- | :----------------------------------------------------------- | :------------------------------------------------------------------- |
| **定義**             | 地理的に独立したエリア                                       | リージョン内にある、互いに隔離されたデータセンターの集合体         |
| **目的**             | データローカリティ、法的要件、災害対策、ネットワークレイテンシの最適化 | リージョン内での高可用性、耐障害性、フォールトトレランス           |
| **S3における役割**   | バケットの物理的な所在地。データが保存される地理的範囲。     | S3が内部的にデータを複製・分散する対象。ユーザーからは抽象化されている。 |
| **ユーザーの関与**   | バケット作成時に必須で選択する。                             | S3では通常、ユーザーが直接選択・意識する必要はない。               |
| **障害の影響範囲**   | リージョン全体の障害は稀だが、発生すれば広範囲に影響。       | 単一AZの障害は他のAZに影響しないよう設計されている。                 |
| **例**               | 東京リージョン (ap-northeast-1)                              | ap-northeast-1a, ap-northeast-1c, ap-northeast-1d など             |

S3においてAZの概念を理解することは、S3がなぜ高い耐久性と可用性を実現できるのか、という問いに対する答えとなります。
S3は複数のAZにデータを自動的に複製・分散することで、基盤となるインフラストラクチャの障害からデータを保護し、継続的なデータアクセスを可能にしているのです。

## バケット ![bucket](./img/bucket.svg)

### バケットとは

Amazon S3の「バケット (Bucket)」は、オブジェクト（データファイル）を格納するための最上位のコンテナです。
S3にデータを保存するには、まずバケットを作成する必要があります。
バケットは、あたかもインターネット上のストレージのルートディレクトリや、大きな論理的な「箱」のようなものと考えることができます。

### バケットの主な特性と重要性

#### 1. グローバルな一意性

*   バケット名は、AWSの全リージョンを通じて**グローバルに一意**である必要があります。
*   つまり、世界中のAWSユーザーの誰かが使用しているバケット名と同じ名前は使用できません。
*   例えば、「my-test-bucket」という名前が既に使われていれば、別の名前を選ばなければなりません。
*   このグローバルな一意性は、S3のエンドポイントURL (例: `http://my-test-bucket.s3.amazonaws.com`) を構成する際に重要になります。

#### 2. リージョンへの関連付け

*   バケットを作成する際には、必ず特定のAWSリージョンを指定する必要があります。
*   バケット自体はグローバルに一意の名前を持ちますが、物理的に存在する場所はその指定されたリージョン内です。
*   このリージョンに、バケット内のオブジェクトが保存されます。

#### 3. 設定の適用範囲

*   多くのS3の重要な設定は、バケットレベルで適用されます。
*   これには、アクセス制御（バケットポリシー、ACL）、バージョニング、ライフサイクル管理、レプリケーション、ウェブサイトホスティング、ロギング、デフォルトの暗号化などが含まれます。
*   これらの設定は、バケット内の全てのオブジェクトに影響を及ぼします。

#### 4. アクセス制御の基本単位

*   バケットは、S3のアクセス制御の基本的な単位です。
*   IAMポリシーやバケットポリシーを使用して、どのユーザーやサービスがバケット内のオブジェクトに対してどのような操作（読み込み、書き込み、削除など）を許可されるかを定義します。

### バケット名の要件

バケット名にはいくつかの重要な制約があります。

*   長さは3文字から63文字である必要があります。
*   小文字の英字、数字、ピリオド (.)、ハイフン (-) のみを使用できます。
*   先頭または末尾をピリオド (.) やハイフン (-) にすることはできません。
*   連続するピリオド (.) は使用できません。
*   IPアドレス形式 (例: `192.168.1.1`) にすることはできません。
*   既存のバケット名と重複することはできません。
*   推奨されるベストプラクティスとして、ドメイン名のような形式 (例: `company-website-logs`) や、用途がわかるような分かりやすい名前 (例: `my-application-backups`) が推奨されます。

### バケットの主要な設定項目

S3バケットには、以下のような重要な設定項目があります。

| 設定項目                 | 説明                                                                                                     |
| :----------------------- | :------------------------------------------------------------------------------------------------------- |
| **リージョン**           | バケットが作成され、データが保存されるAWSリージョンを指定します。                                        |
| **アクセスコントロール**   | - **バケットポリシー:** JSON形式でバケット全体へのアクセス権限を詳細に設定します。<br /> - **ACL (Access Control Lists):** 特定のアカウントやグループに権限を付与する古いメカニズムです。<br /> - **パブリックアクセスブロック設定:** 意図しないパブリックアクセスを防ぐためのセキュリティ機能です。 |
| **バージョニング**       | オブジェクトの変更履歴を保持し、誤った上書きや削除から復旧できるようにします。                           |
| **ライフサイクルルール** | オブジェクトの経過時間やアクセス頻度に応じて、自動的にストレージクラスを変更したり、削除したりするルールを設定します。 |
| **レプリケーション**     | バケット内のオブジェクトを、同じリージョン内または異なるリージョンの別のバケットに自動的に複製します。   |
| **静的ウェブサイトホスティング** | バケットをウェブサイトのホスティング元として設定し、HTMLファイルなどを公開できます。                   |
| **デフォルトの暗号化**   | バケットにアップロードされるすべての新規オブジェクトに対して、デフォルトでサーバー側暗号化を適用します。 |
| **イベント通知**         | オブジェクトの作成、削除などのイベント発生時に、SNS、SQS、Lambdaなどへ通知を送信します。                 |
| **ロギング**             | バケットへのアクセスログを記録し、別のS3バケットに保存します。監査や分析に役立ちます。                   |

### まとめ

バケットはS3の全ての操作の起点となる重要な要素です。
適切な命名規則、リージョン選択、そしてセキュリティ設定を行うことが、S3を安全かつ効率的に利用するための第一歩となります。
これらの設定を通じて、データの耐久性、可用性、セキュリティ、コストを管理します。

## オブジェクト ![object](./img/object.svg)

### オブジェクトとは

Amazon S3における「オブジェクト (Object)」とは、S3に保存される**データ本体**と、そのデータに関連付けられた**メタデータ**、そして**一意のキー**を組み合わせたものです。
S3はオブジェクトストレージであるため、全てのデータはこのオブジェクトの形式でバケット内に保存されます。
一般的なファイルシステムにおける「ファイル」に相当しますが、S3のオブジェクトにはファイルシステムでは扱わない独自の特性があります。

### オブジェクトの主要な構成要素

オブジェクトは以下の3つの要素で構成されます。

1.  **データ本体 (Data)**
    *   S3に保存したい実際のコンテンツです。
    *   画像ファイル、動画ファイル、ドキュメント、バックアップファイル、データベースダンプ、アプリケーションログ、JSON/CSVデータなど、あらゆる形式のデータを保存できます。
    *   1つのオブジェクトのサイズは0バイトから最大5TBまでサポートされます。

2.  **メタデータ (Metadata)**
    *   オブジェクト自体を記述するデータです。
    *   システム定義メタデータとユーザー定義メタデータの2種類があります。

    | メタデータの種類     | 説明                                                                                                     | 例                                                                                                                                                                                            |
    | :------------------- | :------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
    | **システム定義メタデータ** | S3によって自動的に管理される、オブジェクトに関する基本的な情報です。                                   | `Content-Length` (サイズ), `Last-Modified` (最終更新日時), `Content-Type` (MIMEタイプ), `ETag` (オブジェクトのデータ整合性チェック用のハッシュ), `StorageClass` (ストレージクラス)など。 |
    | **ユーザー定義メタデータ** | ユーザーが任意にオブジェクトに追加できる情報です。`x-amz-meta-` というプレフィックスを付けて保存されます。 | オブジェクトの作成者、関連プロジェクト名、特定タグなど。これにより、オブジェクトに追加のコンテキストを付与し、アプリケーションでの利用や検索に役立てることができます。                      |

3.  **キー (Key)**
    *   バケット内でオブジェクトを一意に識別するための名前です。
    *   詳細については、後続の「キー」の項目で詳しく解説しますが、オブジェクトへのアクセスはこのキーを介して行われます。

### オブジェクトの主な特性

#### 1. 不変性 (Immutability)

*   S3のオブジェクトは**不変**です。
*   一度オブジェクトが作成されると、そのコンテンツを変更することはできません。
*   変更を行うには、新しいオブジェクトとしてアップロードする必要があります。
*   バージョニングが有効なバケットでは、同じキーで新しいオブジェクトがアップロードされると、以前のオブジェクトは別のバージョンとして保持されます。

#### 2. フラットな構造

*   S3は従来のファイルシステムのような階層構造を持たず、全てのオブジェクトはバケット内でフラットに並んでいます。
*   しかし、キーにスラッシュ (`/`) を含めることで、S3コンソールやAPIは論理的なフォルダ構造（プレフィックス）をシミュレートし、管理しやすくしています。
*   例: `photos/2023/summer/vacation.jpg` というキーは、論理的には `photos` フォルダ内の `2023` フォルダ内の `summer` フォルダ内の `vacation.jpg` のように見えます。

#### 3. バージョニング (Versioning)

*   バケットレベルでバージョニングを有効にすると、同じキーでオブジェクトを上書きまたは削除した場合でも、オブジェクトの以前のバージョンが保持されます。
*   これにより、データの誤操作からの回復や、履歴の追跡が可能になります。

#### 4. アクセス制御

*   個々のオブジェクトに対してもアクセス制御 (ACL) を設定できますが、一般的にはバケットポリシーやIAMポリシーでアクセスを制御することが推奨されます。
*   これにより、特定のオブジェクトへの読み取り、書き込み、削除権限などを細かく設定できます。

#### 5. 暗号化

*   オブジェクトは、アップロード時または保存時に暗号化することができます。
*   サーバー側暗号化 (SSE-S3, SSE-KMS, SSE-C) や、クライアント側暗号化のオプションがあります。
*   これにより、保存されているデータの機密性が保証されます。

### オブジェクトの操作

S3のオブジェクトに対する一般的な操作は以下の通りです。

*   **PUT (アップロード):** 新しいオブジェクトをバケットに保存するか、既存のオブジェクトを上書きします。
*   **GET (ダウンロード):** バケットからオブジェクトを取得します。
*   **DELETE (削除):** バケットからオブジェクトを削除します。
*   **COPY (コピー):** オブジェクトを同じバケット内または別のバケットにコピーします。
*   **HEAD (メタデータの取得):** オブジェクト本体をダウンロードせずに、そのメタデータのみを取得します。

オブジェクトはS3の中心となる要素であり、その特性と操作方法を理解することは、S3を効果的に利用するための基礎となります。

## オブジェクトにアクセスするためのパス

Amazon S3のオブジェクトにアクセスするには、そのオブジェクトを一意に識別し、場所を特定できる「パス」が必要です。
S3では、主に以下の3つの形式のパスが利用されます。

1.  **キー (Key)**
2.  **S3 URI**
3.  **オブジェクトURL (Object URL)**
4.  **Amazon リソースネーム (ARN)**

これらのパスはそれぞれ異なるコンテキストで利用され、役割も異なります。

### 1. キー (Key)

#### 概念

キーは、バケット内でオブジェクトを一意に識別する文字列です。
S3のオブジェクトストレージはフラットな構造ですが、キーにスラッシュ (`/`) を含めることで、論理的な階層構造を表現できます。

#### 形式

キーは単なる文字列であり、特定の形式はありませんが、一般的にはファイルパスのように記述されます。

*   例: `myphoto.jpg`
*   例: `documents/reports/2023_annual_report.pdf`
*   例: `data/raw_data/2024-01-01.csv`

#### 特徴と用途

*   **バケット内での一意性:** 同じバケット内で、同じキーを持つオブジェクトは存在できません（バージョニングが有効な場合は、同じキーでもバージョンIDが異なります）。
*   **論理的な階層:** S3コンソールでは、キーに含まれるスラッシュをフォルダ区切りとして解釈し、視覚的に階層構造を表示します。これはあくまで見かけ上のものであり、S3の内部ストレージ構造はフラットです。
*   **API操作の基本:** S3のAPI (PutObject, GetObject, DeleteObjectなど) では、操作対象のオブジェクトをキーによって指定します。
*   **メタデータの役割:** オブジェクトのキー自体もメタデータの一部として扱われます。

### 2. S3 URI

#### 概念

S3 URI (Uniform Resource Identifier) は、S3リソース（バケットやオブジェクト）を識別するための標準的なURI形式です。
主にAWS CLIやSDKでS3リソースを指定する際に使用されます。

#### 形式

`s3://<バケット名>/<キー>`

*   例: `s3://my-example-bucket/myphoto.jpg`
*   例: `s3://my-example-bucket/documents/reports/2023_annual_report.pdf`

#### 特徴と用途

*   **AWS CLI/SDKでの利用:** AWS CLIの `aws s3 cp` や `aws s3 sync` コマンドなどで、ローカルファイルパスとS3上のパスを対応させる際によく使用されます。
*   **サービスの識別:** `s3://` というプレフィックスにより、S3サービスのリソースであることが明確に識別できます。
*   **内部的な表現:** AWSの内部ツールやスクリプトで、S3リソースを参照する際の一般的な形式です。
*   **リージョンは含まれない:** S3 URI自体にはリージョン情報は含まれませんが、AWS CLIなどのツールは通常、デフォルトリージョン設定やコマンドラインオプションからリージョンを推測します。

### 3. オブジェクトURL

#### 概念

オブジェクトURLは、ウェブブラウザなどからS3のオブジェクトに直接アクセスするために使用されるHTTP/HTTPSベースのURLです。
オブジェクトが公開設定されている場合や、一時的に署名付きURLが発行された場合に利用されます。

#### 形式

S3のオブジェクトURLには、主に2つの形式があります。

1.  **仮想ホスト形式 (Virtual Hosted Style URL):** 推奨される形式
    `https://<バケット名>.s3.<リージョン名>.amazonaws.com/<キー>`

    *   例: `https://my-example-bucket.s3.ap-northeast-1.amazonaws.com/myphoto.jpg`
    *   例: `https://my-example-bucket.s3.ap-northeast-1.amazonaws.com/documents/report.pdf`

2.  **パス形式 (Path Style URL):** レガシーな形式（特定のリージョンではサポート終了、新規バケットでは推奨されない）
    `https://s3.<リージョン名>.amazonaws.com/<バケット名>/<キー>` または `https://s3.amazonaws.com/<バケット名>/<キー>` (US East (N. Virginia) リージョンのみ)

    *   例: `https://s3.ap-northeast-1.amazonaws.com/my-example-bucket/myphoto.jpg`

#### 特徴と用途

*   **HTTP/HTTPSアクセス:** ウェブブラウザやHTTPクライアントからオブジェクトにアクセスする際に使用されます。
*   **リージョン情報を含む:** 仮想ホスト形式では、URLにリージョン名が含まれるため、どのリージョンのバケットであるかが明確です。
*   **ウェブサイトホスティング:** 静的ウェブサイトホスティングを設定した場合、オブジェクトURLを通じてウェブサイトコンテンツが提供されます。
*   **署名付きURL:** オブジェクトがプライベートな場合でも、一時的にアクセスを許可するために有効期限付きの署名付きURLを生成して共有できます。

### 4. Amazon リソースネーム (ARN)

#### 概念

ARN (Amazon Resource Name) は、AWSのサービス全体でリソースを一意に識別するための標準的な命名規則です。
S3においても、バケットやオブジェクト、アクセスポイントなどのリソースをARN形式で参照できます。
主にIAMポリシーやリソースベースのポリシー（バケットポリシーなど）で、アクセス対象のリソースを指定する際に使用されます。

#### 形式

`arn:aws:s3:::<バケット名>` (バケットの場合)
`arn:aws:s3:::<バケット名>/<キー>` (オブジェクトの場合)

*   例 (バケット): `arn:aws:s3:::my-example-bucket`
*   例 (オブジェクト): `arn:aws:s3:::my-example-bucket/myphoto.jpg`
*   例 (特定のオブジェクトバージョン): `arn:aws:s3:::my-example-bucket/myphoto.jpg?versionId=xxxxxxxx`

#### 特徴と用途

*   **AWS全体での一意性:** AWSアカウント内でリソースを一意に識別します。
*   **ポリシー定義:** IAMポリシーやバケットポリシーで、アクセスを許可または拒否する対象のS3リソースを厳密に指定するために使用されます。
*   **サービス間連携:** AWS Lambda、AWS Glueなどの他のAWSサービスからS3リソースを参照する際にも利用されます。
*   **リージョンは含まれない:** S3のARNにはリージョンが含まれませんが、ポリシー評価時にはコンテキストから判断されます。

### まとめ

これらのパスは、S3のオブジェクトにアクセスするための異なる「住所」のようなものです。
それぞれの形式がどのようなコンテキストで使われるかを理解することで、S3リソースを適切に管理し、効果的に利用することができます。

